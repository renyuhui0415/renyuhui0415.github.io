<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="StarHui"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="canonical" href="https://renyuhui0415.github.io/post/topic_communication.html"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="话题通信的学习以及实操 + 自定义msg实现"><meta property="og:type" content="article"><meta property="og:title" content="ROS学习笔记（3）：通信机制之话题通信"><meta property="og:url" content="https://renyuhui0415.github.io/post/topic_communication.html"><meta property="og:site_name" content="Hexo"><meta property="og:description" content="话题通信的学习以及实操 + 自定义msg实现"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032203410.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032206502.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032210816.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032212177.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032212495.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032213707.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032213421.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032215315.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032218393.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032220945.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032220658.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032222073.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032223578.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032223223.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032223009.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032224564.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032225233.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032227554.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032227260.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032228738.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032229042.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032230710.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032232595.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032233239.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032233472.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032235831.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032235682.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032236605.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032237095.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032237614.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032237023.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032238314.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032238033.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032240513.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032241908.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032242913.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032243783.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032243514.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032247128.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032247013.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032248755.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032249024.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032250726.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032250146.png"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032250683.png"><meta property="article:published_time" content="2023-12-03T13:53:00.000Z"><meta property="article:modified_time" content="2023-12-03T14:52:45.522Z"><meta property="article:author" content="John Doe"><meta property="article:tag" content="ROS"><meta property="article:tag" content="Study Notes"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032203410.png"><link rel="icon" type="image/png" href="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202311052030629.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202311052030629.png"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202311052030629.png"><title>ROS学习笔记（3）：通信机制之话题通信 - StarHui Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/assets/build/styles.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/fonts/fonts.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/fonts/Satoshi/satoshi.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/fonts/Chillax/chillax.css"><script id="hexo-configurations">window.config={hostname:"renyuhui0415.github.io",root:"/",language:"en",path:"search.xml"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0,title_alignment:"left"},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!1,list:[]},code_block:{copy:!0,style:"mac",font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!1,expand:!0,init_open:!0},copyright:!0,lazyload:!0,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:null},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!1,scale:!0},scroll_progress:{bar:!1,percentage:!0},website_counter:{url:"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,open_graph:!0,google_analytics:{enable:!1,id:null},busuanzi_counter:{enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},pjax:!0},home_banner:{enable:!0,style:"fixed",image:{light:"https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202311052020267.png",dark:"https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202311052021237.png"},title:"你好呀，欢迎来到我的博客！",subtitle:{text:["Hi"],hitokoto:{enable:!0,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#fff",dark:"#d1d1b6"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!0,links:{github:"https://github.com/renyuhui0415",instagram:null,zhihu:"https://www.zhihu.com/people/pretend-52-7",twitter:null,email:"renyuhui1864@foxmail.com"},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!0,type:"fixed",audios:[{name:"无人之岛",artist:"任然",url:"https://game.renyuhui.top/static/audio/Unmanned_Island.mp3",cover:"https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202311052024940.jpeg"}]},mermaid:{enable:!1,version:"9.3.0"}},version:"2.5.6",navbar:{auto_hide:!0,color:{left:"#f78736",right:"#367df7",transparency:35},links:{Home:{path:"/",icon:"fa-regular fa-house"},Projects:{icon:"fa-solid fa-link",submenus:{"My Game":"https://game.renyuhui.top/","My ChatGpt":"https://chat.renyuhui.top/"}},About:{icon:"fa-regular fa-user",submenus:{Me:"/about",Github:"https://github.com/renyuhui0415",Blog:"https://blog.csdn.net/weixin_73090892?type=blog",Friends:"/friends"}}},search:{enable:!0,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"right",first_item:"menu",announcement:"让自己发光，胜过埋怨一切黑暗。",links:{Archives:{path:"/archives",icon:"fa-regular fa-archive"},ShuoShuo:{path:"/essays",icon:"fa-regular fa-comment-dots icon-space"},Photo:{path:"/masonry",icon:"fa-solid fa-image"}}},article_date_format:"auto",categories:{enable:!0,limit:3},tags:{enable:!0,limit:3}},footerStart:"2023/6/6 13:37:00"},window.lang_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"},window.data={masonry:!0}</script><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/fontawesome/brands.min.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/fontawesome/solid.min.css"><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/fontawesome/regular.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div class="progress-bar-container"><span class="pjax-progress-bar"></span> <span class="swup-progress-icon"><i class="fa-solid fa-circle-notch fa-spin"></i></span></div><main class="page-container" id="swup"><div class="main-content-container"><div class="main-content-header"><header class="navbar-container"><div class="navbar-content"><div class="left"><a class="logo-title" href="/">StarHui Blog</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house"></i> HOME</a></li><li class="navbar-item"><a class="has-dropdown" href="#" onclick="return!1"><i class="fa-solid fa-link"></i> PROJECTS&nbsp;<i class="fa-solid fa-chevron-down"></i></a><ul class="sub-menu"><li><a target="_blank" rel="noopener" href="https://game.renyuhui.top/">MY GAME</a></li><li><a target="_blank" rel="noopener" href="https://chat.renyuhui.top/">MY CHATGPT</a></li></ul></li><li class="navbar-item"><a class="has-dropdown" href="#" onclick="return!1"><i class="fa-regular fa-user"></i> ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i></a><ul class="sub-menu"><li><a href="/about">ME</a></li><li><a target="_blank" rel="noopener" href="https://github.com/renyuhui0415">GITHUB</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_73090892?type=blog">BLOG</a></li><li><a href="/friends">FRIENDS</a></li></ul></li><li class="navbar-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color"><ul class="drawer-navbar-list flex flex-col justify-start items-center"><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/"><i class="fa-regular fa-house"></i> HOME</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" href="#" onclick="return!1"><i class="fa-solid fa-link"></i> PROJECTS&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i></a></li><li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="py-0.5" target="_blank" rel="noopener" href="https://game.renyuhui.top/">MY GAME</a></li><li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="py-0.5" target="_blank" rel="noopener" href="https://chat.renyuhui.top/">MY CHATGPT</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" href="#" onclick="return!1"><i class="fa-regular fa-user"></i> ABOUT&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i></a></li><li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="py-0.5" href="/about">ME</a></li><li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="py-0.5" target="_blank" rel="noopener" href="https://github.com/renyuhui0415">GITHUB</a></li><li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="py-0.5" target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_73090892?type=blog">BLOG</a></li><li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="py-0.5" href="/friends">FRIENDS</a></li></ul></div><div class="window-mask"></div></header></div><div class="main-content-body"><div class="main-content"><div class="post-page-container"><div class="article-content-container"><div class="article-title relative w-full"><img src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202311291846470.png" alt="ROS学习笔记（3）：通信机制之话题通信" class="w-full h-60 sm:h-72 md:h-80 object-cover sm:rounded-t-large dark:brightness-75"><div class="w-full flex items-center absolute bottom-0 justify-start"><h1 class="article-title-cover text-center mx-6 my-6 text-second-text-color bg-background-color-transparent px-4 py-3 text-3xl sm:text-4xl md:text-5xl font-bold backdrop-blur-lg rounded-xl border border-border-color">ROS学习笔记（3）：通信机制之话题通信</h1></div></div><div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202311052032318.jpg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">StarHui</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2023-12-03 21:53</span> <span class="mobile">2023-12-03 21:53</span> <span class="hover-info">Created</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2023-12-03 22:52:45</span> <span class="mobile">2023-12-03 22:52:45</span> <span class="hover-info">Updated</span> </span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/ROS/">ROS</a>&nbsp;</li><li>| <a href="/tags/Study-Notes/">Study Notes</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>5.6k Words</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>22 Mins</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8"><h1 id="前置知识">前置知识</h1><p>在介绍通信机制之前，咱们先来了解ROS中的两个个核心概念：<strong>节点（node）</strong>、<strong>节点管理器（ROS Master）</strong><br>节点是ROS软件包中的一个<strong>可执行文件</strong>。ROS节点使用ROS客户端库与其他节点通信。 <strong>不同的节点甚至可以使用不同的编程语言，以及运行在不同的主机上。</strong> 更加详细的介绍可以看这：<a class="link" target="_blank" rel="noopener" href="http://wiki.ros.org/cn/ROS/Tutorials/UnderstandingNodes">理解ROS节点 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><p>ROS Master 为 ROS 系统中的其余节点提供<strong>命名</strong>和<strong>注册</strong>服务。它跟踪主题和服务的发布者和订阅者。 Master 的作用是<strong>使各个 ROS 节点能够相互定位</strong>。一旦这些节点找到彼此，它们就会进行点对点通信。<br>在使用roscore 命令时，该命令加载 ROS Master 以及其他基本组件。<br><a class="link" target="_blank" rel="noopener" href="http://wiki.ros.org/Master">ROS Master <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h1 id="概述">概述</h1><p>ROS是机器人操作系统，机器人是一种比较复杂的系统性实现，在机器人上面可能有很多传感器以及运动控制实现，也就意味着有很多个节点。那么我们想要实现指定动作的时候，需要用到很多节点，节点之间是如何通信呢？</p><p>ROS基本通信机制有如下三种</p><ul><li><p>话题通信（发布订阅模式）</p></li><li><p>服务通信（请求响应模式）</p></li><li><p>参数服务器（参数共享模式）</p></li></ul><p>接下来让我们详细看看这三种通信机制。</p><h1 id="话题通信">话题通信</h1><p>话题通信是ROS中<strong>使用频率最高</strong>的一种通信模式，话题通信是<strong>基于发布订阅模式</strong>的，即：一个节点发布消息，另外一个节点订阅该消息。话题通信适用于<strong>不断更新的数据传输相关</strong>的应用场景。<br>接下来让我们看一下话题通信的理论模型吧。</p><h2 id="理论模型">理论模型</h2><p>在话题通信机制中，有三个角色 ROS Master（管理者）、Talker（发布者）、Listener（订阅者）。</p><p>职责分布：ROS Master会保存 Talker、Listener的注册信息，当Listener订阅的主题存在时，就会帮助Listener与 发布该主题的Talker 建立联系。联系建立后，ROS Master就没有什么作用了，当Talker再次发布消息，然后Listener就能看到 Talker发布的消息。<br>接下来让我们看一下底层是如何实现的。</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032203410.png"></p><p>咱们来详细讲一下每一个流程。</p><ol start="0" type="1"><li><p>当Talker启动时，会在ROS Maser那边登记信息，有主题、RPC地址等信息</p></li><li><p>当Listener启动时，也会在ROS Maser登记信息，有需要订阅消息的话题名等</p></li><li><p>ROS Master进行匹配，如果 Listener 需要订阅的话题存在的话，就会通过RPC给 Listener发送 发布该主题 Talker的RPC地址信息。</p></li><li><p>Listener通过 RPC向 Talker发送连接信息</p></li><li><p>Talker确认连接信息后，发送自身的TCP地址信息。</p></li><li><p>Listener 通过TCP地址信息 与 Talker建立连接。</p></li><li><p>当Talker再次发布消息时，Listener就能接收到消息，完成了订阅该主题。</p></li></ol><p>其中，Talker、Listener注册无先后顺序。而且Talker、Listener可以有多个，可以一个Talker对多个Listener。<br>现在话题通信已经比较成熟了，被封装成包了，咱们不需要实现那么多的底层操作，只需要设置一些参数即可。</p><h2 id="c实现话题通信">C++实现话题通信</h2><p>咱们来用C++实现一个话题通信的实例.</p><blockquote><p>编写发布订阅实现，要求发布方以10HZ(每秒10次)的频率发布文本消息，订阅方订阅消息并将消息内容打印输出。</p></blockquote><p>首先就是创建工作空间、创建ROS包等。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建工作空间并编译</span></span><br><span class="line">mkdir -p topic_communication/src</span><br><span class="line">cd topic_communication</span><br><span class="line">catkin_make</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建ROS包并添加依赖</span></span><br><span class="line">cd src/</span><br><span class="line">catkin_create_pkg pub_sub roscpp rospy std_msgs</span><br></pre></td></tr></table></figure></div><p>可以使用 tree 命令查看文件结构，目前该工作空间结构如下图(只显示了文件夹，没有显示文件)</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032206502.png"></p><h3 id="talker实现">talker实现</h3><p>然后咱们在 topic_communication/src/pub_sub/src 子目录下创建一个cpp文件，就可以开始写程序了。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/src/pub_sub/src</span><br><span class="line">vim pub.cpp</span><br></pre></td></tr></table></figure></div><p>由于是初次接触，先有易到难编写程序，即先不停发送hello，后面在修改为按照频率发送消息。<br>下面为程序内容</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//初始化节点，节点名为 talker</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;talker&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建节点句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建发布者对象</span></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">&quot;chat&quot;</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建被发布的消息</span></span><br><span class="line">    std_msgs::String msg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当节点存在时，一直循环</span></span><br><span class="line">    <span class="keyword">while</span>(ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//给消息添加内容</span></span><br><span class="line">        msg.data = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发布消息</span></span><br><span class="line">        pub.<span class="built_in">publish</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>关于这段代码，大家需要看一下函数用法。</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建发布者对象</span></span><br><span class="line">ros::NodeHandle::<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="type">const</span> std::string &amp;topic, <span class="type">uint32_t</span> queue_size, <span class="type">bool</span> latch = <span class="literal">false</span>)</span><br></pre></td></tr></table></figure></div><p>第一个参数为topic，就是准备发布的主题名字；第二个参数为当消息堵塞时，缓存区的大小，也就是所能保留消息的条数；第三个可写可不写，如果为 "true"，将保存在此主题上发布的最后一条信息，并在新用户连接时发送给他们。</p><p><strong>还有一个疑惑，为什么要创建节点句柄，它的作用是什么？</strong><br>后面找了一下官方教程，是这样解释的。<br>NodeHandle 是 roscpp <strong>用于创建订阅者、发布者等的接口</strong>。该类用于编写节点。它为该进程的节点提供了一个 RAII 接口，即在创建第一个 NodeHandle 时，它会实例化该节点所需的一切，而当最后一个 NodeHandle 退出作用域时，它会关闭节点。</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032210816.png"></p><p><a class="link" target="_blank" rel="noopener" href="https://docs.ros.org/en/noetic/api/roscpp/html/classros_1_1NodeHandle.html#details">NodeHandle <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><hr><p>下一步是修改CMakeLists.txt</p><p>把136行注释取消，修改 ${PROJECT_NAME}_node 以及路径<br>取消149～151的注释，把 ${PROJECT_NAME}_node替换为刚才修改的名字</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032212177.png"></p><p>然后回到工作空间，并编译。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure></div><p>最后就是运行这个包（启动内核，刷新环境变量，运行包）</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032212495.png"></p><p>由于咱们没有打印调试信息，所以咱们什么都看不到，可以在终端使用rostopic echo命令</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">rostopic <span class="built_in">echo</span> topic_name</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把topic_name替换为自己的话题名字</span></span><br><span class="line">rostopic echo chat</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032213707.png"></p><p>咱们之前发送的消息就是 hello，说明发布部分写正确了。接下来咱们按照要求 10HZ完成发送消息的任务。代码如下</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//设置编码，解决中文乱码问题</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化节点，节点名为 talker</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;talker&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建节点句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建发布者对象</span></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;std_msgs::String&gt;(<span class="string">&quot;chat&quot;</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建被发布的消息</span></span><br><span class="line">    std_msgs::String msg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//数据</span></span><br><span class="line">    std::string msg_front = <span class="string">&quot;Hello 你好！&quot;</span>;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置一个定时器，帮助我们以所需频率运行循环</span></span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当节点存在时，一直循环</span></span><br><span class="line">    <span class="keyword">while</span>(ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//实例化std::stringstream对象，使用它完成字符串的拼接</span></span><br><span class="line">        std::stringstream ss;</span><br><span class="line"></span><br><span class="line">        ss &lt;&lt; msg_front &lt;&lt; count;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//给消息添加内容</span></span><br><span class="line">        msg.data = ss.<span class="built_in">str</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//发布消息</span></span><br><span class="line">        pub.<span class="built_in">publish</span>(msg);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//输出调试信息</span></span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;发布的消息为：%s&quot;</span>,ss.<span class="built_in">str</span>().<span class="built_in">c_str</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//达到睡眠时间，自动休眠</span></span><br><span class="line">        r.<span class="built_in">sleep</span>();</span><br><span class="line"></span><br><span class="line">        count++;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>下面是效果图</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032213421.png"></p><h3 id="listener实现">listener实现</h3><p>接下来把listener实现一下。</p><p>首先进入到 topic_communication/src/pub_sub/src ，然后开始写订阅程序。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果路径不同，请替换为自己的路径</span></span><br><span class="line">cd ~/topic_communication/src/pub_sub/src/</span><br><span class="line">vim sub.cpp</span><br></pre></td></tr></table></figure></div><p>代码如下</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;std_msgs/String.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//回调函数处理消息</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">handle_msg</span><span class="params">(<span class="type">const</span> std_msgs::String::ConstPtr&amp; msg_p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;接收到的消息：%s&quot;</span>,msg_p -&gt; data.<span class="built_in">c_str</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//设置编码格式</span></span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化节点 listener</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;listener&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建节点话柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建订阅者对象</span></span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>&lt;std_msgs::String&gt;(<span class="string">&quot;chat&quot;</span>,<span class="number">10</span>,handle_msg);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//启动ROS节点的事件循环</span></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div><p>关于这段代码，有两个需要解释的地方</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros::Subscriber sub = nh.<span class="built_in">subscribe</span>&lt;std_msgs::String&gt;(<span class="string">&quot;chat&quot;</span>,<span class="number">10</span>,handle_msg);</span><br></pre></td></tr></table></figure></div><p>这个是创建一个订阅者对象，ros::Subscriber 声明了类型，通过使用nh的subscribe函数来生成了一个对象。关于subscribe函数，有13种重载（使用方法），大家可以选择任意一种</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032215315.png"></p><p>这里使用的是第二种，第一个参数为需要订阅的话题；第二个参数为缓冲区大小，即当消息堵塞时，所能保留消息的条数；第三个是一个回调函数，用于处理消息。关于回调函数，请看 <a class="link" target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/627181746">回调函数(callback)是什么？一文理解回调函数(callback) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros::<span class="built_in">spin</span>();</span><br></pre></td></tr></table></figure></div><p>这个代码起什么作用？<br>ros::spin()的作用是使订阅者对象（sub）开始监听来自"chat"话题的消息。通过调用ros::spin()，程序将持续监听并处理接收到的消息，直到节点被关闭。当有新的消息到来时，ROS会自动触发回调函数handle_msg()，并将收到的消息作为参数传递给回调函数进行处理。有点STM32里面中断那味。<br>可以详细看一下这个 <a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_40215443/article/details/103793316">ros::spin()、ros::spinOnce()：使用细节、区别 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>，并于 ros::spinonce()做一个区分.</p><hr><p>然后修改CMakeLists.txt</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032218393.png"></p><p>然后回到工作空间并编译</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure></div><p>最后看一下效果</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032220945.png"></p><p>记得在运行节点前，要刷新一下环境变量哈</p><p>为了更加直观显示通信的逻辑，咱们可以使用 rqt_graph 显示当前运行的节点和话题。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果没有安装的话。请放开注释 进行安装</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sudo apt-get install ros-&lt;distro&gt;-rqt</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">sudo apt-get install ros-&lt;distro&gt;-rqt-common-plugins</span></span><br><span class="line">rosrun rqt_graph rqt_graph</span><br></pre></td></tr></table></figure></div><p>注意：当进行通信的时候，才能查看到内容。</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032220658.png"></p><p>可以看到，talker、listener节点在通过 chat话题进行通信。</p><h2 id="python实现话题通信">Python实现话题通信</h2><p>还是上面那个实例，咱们用rospy来实现一下。由易到难实现。</p><h3 id="talker实现-1">talker实现</h3><p>首先在ROS包下创建一个 scripts文件夹，并在该目录下创建pub.py</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/src/pub_sub/</span><br><span class="line">mkdir scripts</span><br><span class="line">cd scripts</span><br><span class="line">vim pub.py</span><br></pre></td></tr></table></figure></div><p>pub.py内容如下</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#初始化节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;talker_py&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建发布者对象</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;chat_py&quot;</span>,String,queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建字符串类型消息</span></span><br><span class="line">    msg = String()</span><br><span class="line"></span><br><span class="line">    <span class="comment">#当节点没有被关闭时，一直发送消息</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        </span><br><span class="line">        msg.data = <span class="string">&quot;hello_py&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">#发布消息</span></span><br><span class="line">        pub.publish(msg)</span><br></pre></td></tr></table></figure></div><p>对于这段代码，大家需要看一下Publisher、is_shutdown这两个函数的用法。</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pub = rospy.Publisher(<span class="string">&quot;chat_py&quot;</span>,String,queue_size=<span class="number">10</span>)</span><br></pre></td></tr></table></figure></div><p>创建 rospy.Publisher 所需的参数只有主题名称、消息类别和队列大小。还可以使用其他高级选项来配置 "发布者"</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032222073.png"></p><p>is_shutdown函数用于判断节点是否关闭，如果关闭的话，返回True，否则返回False。</p><hr><p>保存并退出后，给该文件添加可执行权限。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x pub.py</span><br></pre></td></tr></table></figure></div><p>然后去ROS包子目录下修改</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">此时路径为：topic_communication/src/pub_sub/scripts</span></span><br><span class="line">vim ../CMakeLists.txt </span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032223578.png"></p><p>取消注释，并把py文件路径修改为自己的路径</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032223223.png"></p><p>回到工作空间，进行编译</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032223009.png"></p><p>接下来运行节点，并使用rostopic echo 查看消息</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032224564.png"></p><p>最后，再按照实例要求，完成按照频率发布消息的任务。</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#初始化节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;talker_py&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建发布者对象</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;chat_py&quot;</span>,String,queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建字符串类型消息</span></span><br><span class="line">    msg = String()</span><br><span class="line">    msg_front = <span class="string">&quot;hello_py&quot;</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#设置频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#当节点没有被关闭时，一直发送消息</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        </span><br><span class="line">        msg.data = msg_front + <span class="built_in">str</span>(count)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#发布消息</span></span><br><span class="line">        pub.publish(msg)</span><br><span class="line"></span><br><span class="line">        rospy.loginfo(<span class="string">&quot;发布的消息：%s&quot;</span>,msg.data)</span><br><span class="line"></span><br><span class="line">        rate.sleep()</span><br><span class="line">        count += <span class="number">1</span></span><br></pre></td></tr></table></figure></div><p>最后重新编译，刷新环境变量，重新启动节点，使用 rostopic echo命令查看消息</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032225233.png"></p><h3 id="listener实现-1">listener实现</h3><p>首先进入scripts文件夹内，并在这里创建sub.py</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/src/pub_sub/scripts</span><br><span class="line">vim sub.py</span><br></pre></td></tr></table></figure></div><p>sub.py内容如下</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> std_msgs.msg <span class="keyword">import</span> String</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_msg</span>(<span class="params">msg</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;接收到的消息：%s&quot;</span>,msg.data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#初始化节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;sub_py&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#创建订阅者对象</span></span><br><span class="line">    sub = rospy.Subscriber(<span class="string">&quot;chat_py&quot;</span>,String,handle_msg,queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#设置循环调用回调函数</span></span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure></div><p>其中大部分与C++实现类似，大家着重看一下函数用法</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sub = rospy.Subscriber(<span class="string">&quot;chat_py&quot;</span>,String,handle_msg,queue_size=<span class="number">10</span>)</span><br></pre></td></tr></table></figure></div><p>一般只需要这几个参数，第一个参数为需要订阅话题的名字；第二个是消息类型；第三个是回调函数；第四个缓冲区大小</p><hr><p>保存并退出后，给该文件添加可执行权限。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x sub.py</span><br></pre></td></tr></table></figure></div><p>然后去ROS包子目录下修改</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">此时路径为：topic_communication/src/pub_sub/scripts</span></span><br><span class="line">vim ../CMakeLists.txt </span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032227554.png"></p><hr><p>最后回到工作空间，编译，并运行sub_py、pub_py节点</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032227260.png"></p><p>最后再使用 rosrun rqt_graph rqt_graph查看图</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032228738.png"></p><p>大家可以看一下rospy官方的示例: <a class="link" target="_blank" rel="noopener" href="http://wiki.ros.org/rospy/Overview/Publishers%20and%20Subscribers#Subscribing_to_a_topic">官方示例 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h2 id="c与python节点通信">C++与Python节点通信</h2><p>在ROS中，使用不同编程语言的节点之间也可以进行通信。很神奇吧。</p><p>咱们在前面写过的代码里稍微修改一下，就可以实现了。<br>这里发布者节点为用的是C++ 节点（节点名：sub），订阅者节点使用的是Python节点（节点名：sub_py）。<br>为了让它们之间通信，需要修改一下sub_py节点订阅的话题。sub节点的话题为 chat，咱们需要把sub_py节点订阅的话题修改为chat。</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sub = rospy.Subscriber(<span class="string">&quot;chat&quot;</span>,String,handle_msg,queue_size=<span class="number">10</span>)</span><br></pre></td></tr></table></figure></div><p>修改这一句话就可以了。<br>然后就是重新编译，刷新环境变量 运行节点。</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032229042.png"></p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032230710.png"></p><h2 id="自定义msg">自定义msg</h2><p>在前面的案例中，我们传输的数据是 std_msgs中的String数据类型，只包含了一个data字段，有一定局限性，std_msgs中其他的数据类型Int32、Int64、Char、Bool、Empty也是如此。</p><p>当传输复杂的数据的时候，比如激光雷达的信息，std_msgs就不太行了，这时候咱们可以选择自定义消息类型。</p><p>msgs只是简单的文本文件，每行具有字段类型和字段名称，可以使用的字段类型有：</p><ul><li><p>int8, int16, int32, int64 (或者无符号类型: uint*)</p></li><li><p>float32, float64</p></li><li><p>string</p></li><li><p>time, duration（时间、持续时间）</p></li><li><p>other msg files（其他msg文件）</p></li><li><p>variable-length array[] and fixed-length array[C]（可变长度数组、固定长度数组）</p></li></ul><p>ROS中还有一种特殊类型：Header，标头包含时间戳和ROS中常用的坐标帧信息。会经常看到msg文件的第一行具有Header标头。</p><p>为了直观，这里咱们直接实际创建一个自定义msg。<br><strong>要求：消息包含人的信息:姓名、身高、年龄等</strong> 大致流程如下</p><ol type="1"><li><p>按照固定格式创建 msg 文件</p></li><li><p>编辑配置文件</p></li><li><p>编译生成可以被 Python 或 C++ 调用的中间文件</p></li></ol><h3 id="定义msg文件">定义msg文件</h3><p>首先回到功能包目录下，创建一个msg目录</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/src/pub_sub/</span><br><span class="line">mkdir msg</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">msg不能变，必须这一个名字</span></span><br></pre></td></tr></table></figure></div><p>然后进入msg子目录下，创建一个 .msg文件</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd msg/</span><br><span class="line">vim Person.msg</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">.msg文件名可以随便起</span></span><br></pre></td></tr></table></figure></div><p>Person.msg内容如下</p><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string name</span><br><span class="line">uint16 age</span><br><span class="line">float64 height</span><br></pre></td></tr></table></figure></div><p>我来解释一下语法。<br>.msg文件每行具有字段类型和字段名称。第一行定义了一个字符串类型的name字段，第二行定义了一个无符号16位的整数age字段，第三行定义了一个64位浮点数的height字段。<br>有一点点像C++的结构体！</p><h3 id="编辑配置文件">编辑配置文件</h3><p>我在CMakeLists.txt看到了下图，配置步骤。</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032232595.png"></p><p>接下来需要修改ROS包文件夹下的package.xml文件</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032233239.png"></p><p>在这里添加编译依赖项、执行依赖项</p><div class="highlight-container" data-rel="Xml"><figure class="iseeu highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build_depend</span>&gt;</span>message_generation<span class="tag">&lt;/<span class="name">build_depend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">exec_depend</span>&gt;</span>message_runtime<span class="tag">&lt;/<span class="name">exec_depend</span>&gt;</span></span><br></pre></td></tr></table></figure></div><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032233472.png"></p><p>Package.xml是干什么的呢？</p><p><strong>package.xml文件定义了package的属性。（例如：包名，版本号，作者，一来等等），相当于一个包的自我描述。</strong><br>详细解读可以看：<a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/wangxiao7474/article/details/109840779">package.xml的使用说明和作用 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><hr><p>然后修改ROS包下的CMakeLists.txt文件<br>（1）在find_package那里添加包</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032235831.png"></p><div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">find_package</span>(catkin REQUIRED COMPONENTS</span><br><span class="line">  roscpp</span><br><span class="line">  rospy</span><br><span class="line">  std_msgs</span><br><span class="line">  message_generation</span><br><span class="line">)</span><br></pre></td></tr></table></figure></div><p>find_package是查找编译依赖的其他CMake/Catkin包（声明依赖库）。自定义msg编译时需要message_generation。</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032235682.png"></p><p>注意：message_genration是基于std_msgs实现的，std_msgs不能删除</p><p>（2） 在add_message_files添加自定义msg文件，并且把注释放开</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032236605.png"></p><div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add_message_files(</span><br><span class="line">  FILES</span><br><span class="line">  Person.msg <span class="comment">#替换为自己的msg文件名</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></div><p>add_message_files这个是消息生成器。当自定义msg需要在这里添加msg文件</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032237095.png"></p><p>（3） 把generate_messages注释放开，去生成消息</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032237614.png"> <img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032237023.png"></p><p>在这里调用了消息生成器，用于生成自定义的msg。</p><p>（4）catkin_package添加包</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032238314.png"></p><div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">catkin_package(</span><br><span class="line"><span class="comment">#  INCLUDE_DIRS include</span></span><br><span class="line"><span class="comment">#  LIBRARIES pub_sub</span></span><br><span class="line"> CATKIN_DEPENDS roscpp rospy std_msgs message_runtime</span><br><span class="line"><span class="comment">#  DEPENDS system_lib</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure></div><p>catkin_package()是一个由catkin提供的CMake宏。需要指定特定的catkin信息到编译系统，而这些信息又会被用于生成pkg-config和CMake文件。</p><p>在这里，给它添加了当前项目依赖的其他catkin项目</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032238033.png"></p><p>到这里，修改配置文件已经结束了。 希望大家再看看package.xml、CMakeLists.txt的解读，不能知其然而不知其所以然！！！</p><p><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/jinking01/article/details/102891918">ROS的CMakeList文件详解 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/wangxiao7474/article/details/109840779">package.xml的使用说明和作用 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p><h3 id="查看msg的中间文件">查看msg的中间文件</h3><p>首先回到工作空间，重新编译一下。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/</span><br><span class="line">catkin_make</span><br></pre></td></tr></table></figure></div><p>编译成功后，可以在工作空间下的devel文件夹内查看中间文件。<br>C++可以用的msg中间文件在 topic_communication/devel/include/pub_sub/Person.h topic_communication为我的工作空间名字，pub_sub为我的ROS包名字。<br>注意：大家路径可能不一样，因为工作空间、ROS包的名字不一样。</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032240513.png"></p><p>虽然看不太懂，但是还是可以看到已经成功创建了name、age、height这三个字段的。<br>当我们使用C++想要发送自定义消息的时候，就可以include这个头文件了</p><hr><p>下面咱们可以看一下适用与Python的中间文件。<br>路径：topic_communication/devel/lib/python3/dist-packages/pub_sub/msg<br>topic_communication为我的工作空间名字，pub_sub为我的ROS包名字</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032241908.png"></p><p>同样看不懂，但是还是能看到我们创建的字段。<br>Python调用的时候使用from import调用即可</p><h2 id="c使用自定义msg">C++使用自定义msg</h2><p>和前面的案例一样，10HZ的频率发布消息。不同的是，消息的数据类型变了。<br>还是在之前的ROS包下的src文件夹内创建一个cpp文件。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/src/pub_sub/src/</span><br><span class="line">vim pub_custom_msg.cpp</span><br></pre></td></tr></table></figure></div><p>程序内容</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pub_sub/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化节点</span></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;A&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建节点句柄</span></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建发布者对象</span></span><br><span class="line">    ros::Publisher pub = nh.<span class="built_in">advertise</span>&lt;pub_sub::Person&gt;(<span class="string">&quot;chat_person&quot;</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建自定义msg</span></span><br><span class="line">    pub_sub::Person p;</span><br><span class="line">    p.name = <span class="string">&quot;starhui&quot;</span>;</span><br><span class="line">    p.age = <span class="number">19</span>;</span><br><span class="line">    p.height = <span class="number">1.83</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ros::Rate <span class="title">r</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (ros::<span class="built_in">ok</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        pub.<span class="built_in">publish</span>(p);</span><br><span class="line">        <span class="built_in">ROS_INFO</span>(<span class="string">&quot;我叫:%s,今年%d岁,高%.2f米&quot;</span>, p.name.<span class="built_in">c_str</span>(), p.age, p.height);</span><br><span class="line">        </span><br><span class="line">        r.<span class="built_in">sleep</span>();</span><br><span class="line">        p.age += <span class="number">1</span>;</span><br><span class="line">        p.height += <span class="number">0.01</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>接下来修改CMakeLists.txt</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032242913.png"></p><p>这里咱们多修改了一个内容</p><div class="highlight-container" data-rel="Cmake"><figure class="iseeu highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># add_dependencies($&#123;PROJECT_NAME&#125;_node $&#123;$&#123;PROJECT_NAME&#125;_EXPORTED_TARGETS&#125; $&#123;catkin_EXPORTED_TARGETS&#125;)</span></span><br><span class="line"><span class="keyword">add_dependencies</span>(pub_custom_msg <span class="variable">$&#123;PROJECT_NAME&#125;</span>_generate_messages_cpp)</span><br></pre></td></tr></table></figure></div><p>添加这个的原因是：</p><p>告诉Catkin构建系统在构建该节点之前先构建所依赖的目标。通俗解释就是<br>咱们前面定义了msg文件并且配置好了，如果还没有编译的话；此时把cpp文件也写好了，也需要编译，但是cpp文件是依赖msg的中间文件的，那么编译器会先编译cpp文件，在编译msg，这样就会有报错。</p><p>最后编译，刷新环境变量，运行pub_custom_msg节点，使用rostopic echo命令查看消息。</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032243783.png"></p><p>注意：当使用 rostopic echo命令报如下错误的时候，需要进入工作空间，并使用source ./devel/setup.bash刷新环境变量。<br>是因为没有把这个添加到~/.bashrc，当开新终端的时候，不知道自定义msg的路径，需要刷新一下。</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032243514.png"></p><hr><p>接下来完成订阅方。<br>还是在之前的ROS包下的src文件夹内创建一个cpp文件。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/src/pub_sub/src/</span><br><span class="line">vim sub_custom_msg.cpp</span><br></pre></td></tr></table></figure></div><p>程序内容</p><div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ros/ros.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;pub_sub/Person.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">handle_msg</span><span class="params">(<span class="type">const</span> pub_sub::Person::ConstPtr&amp; msg_p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;接收的信息:%s, %d, %.2f&quot;</span>, msg_p-&gt;name.<span class="built_in">c_str</span>(), msg_p-&gt;age, msg_p-&gt;height);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">setlocale</span>(LC_ALL,<span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ros::<span class="built_in">init</span>(argc,argv,<span class="string">&quot;B&quot;</span>);</span><br><span class="line"></span><br><span class="line">    ros::NodeHandle nh;</span><br><span class="line"></span><br><span class="line">    ros::Subscriber sub = nh.<span class="built_in">subscribe</span>&lt;pub_sub::Person&gt;(<span class="string">&quot;chat_person&quot;</span>,<span class="number">10</span>,handle_msg);</span><br><span class="line"></span><br><span class="line">    ros::<span class="built_in">spin</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><p>和前面一样配置CMakeLists.txt</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032247128.png"></p><p>然后编译、刷新环境变量，运行A、B这两个节点</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032247013.png"></p><h2 id="python使用自定义msg">Python使用自定义msg</h2><p>和前面的案例一样，10HZ的频率发布消息。</p><p>还是在之前的ROS包下的scripts文件夹内创建一个py文件。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/src/pub_sub/scripts/</span><br><span class="line">vim pub_custom_msg.py</span><br></pre></td></tr></table></figure></div><p>程序内容</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> pub_sub.msg <span class="keyword">import</span> Person</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#初始化节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;C&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#传建发布者对象</span></span><br><span class="line">    pub = rospy.Publisher(<span class="string">&quot;chat_person_py&quot;</span>,Person,queue_size=<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">#传建自定义msg</span></span><br><span class="line">    p = Person()</span><br><span class="line">    p.name = <span class="string">&quot;starhui&quot;</span></span><br><span class="line">    p.age = <span class="number">19</span></span><br><span class="line">    p.height = <span class="number">1.83</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#设定频率</span></span><br><span class="line">    rate = rospy.Rate(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#当节点没有关闭的时候，一直发送消息</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> rospy.is_shutdown():</span><br><span class="line">        <span class="comment">#发布消息</span></span><br><span class="line">        pub.publish(p)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#输出调试信息</span></span><br><span class="line">        rospy.loginfo(<span class="string">&quot;from python 姓名:%s, 年龄:%d, 身高:%.2f&quot;</span>,p.name, p.age, p.height)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#休眠</span></span><br><span class="line">        rate.sleep()</span><br><span class="line"></span><br><span class="line">        <span class="comment">#更新数据</span></span><br><span class="line">        p.age += <span class="number">1</span></span><br><span class="line">        p.height += <span class="number">0.01</span></span><br></pre></td></tr></table></figure></div><p>接下来给该python文件添加可执行权限。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x pub_custom_msg.py</span><br></pre></td></tr></table></figure></div><p>修改CMakeLists.txt,给catkin_install_python添加刚才的python文件</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032248755.png"></p><p>最后重新编译 刷新一下环境变量，运行节点</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032249024.png"></p><hr><p>最后我们来写订阅者</p><p>还是在之前的ROS包下的scripts文件夹内创建一个py文件。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/topic_communication/src/pub_sub/scripts/</span><br><span class="line">vim sub_custom_msg.py</span><br></pre></td></tr></table></figure></div><p>程序内容</p><div class="highlight-container" data-rel="Py"><figure class="iseeu highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">from</span> pub_sub.msg <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_msg</span>(<span class="params">msg_p</span>):</span><br><span class="line">    rospy.loginfo(<span class="string">&quot;from python 接受的信息：%s,%d,%.2f&quot;</span>,msg_p.name,msg_p.age,msg_p.height)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#初始化节点</span></span><br><span class="line">    rospy.init_node(<span class="string">&quot;D&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#传建订阅者对象</span></span><br><span class="line">    sub = rospy.Subscriber(<span class="string">&quot;chat_person_py&quot;</span>,Person,handle_msg,queue_size=<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#循环处理回调函数</span></span><br><span class="line">    rospy.spin()</span><br></pre></td></tr></table></figure></div><p>接下来给该python文件添加可执行权限。</p><div class="highlight-container" data-rel="Shell"><figure class="iseeu highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x sub_custom_msg.py</span><br></pre></td></tr></table></figure></div><p>修改CMakeLists.txt,给catkin_install_python添加刚才的python文件</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032250726.png"></p><p>编译、刷新环境变量，运行节点</p><p><img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032250146.png"> <img lazyload src="/images/loading.svg" data-src="https://cdn.jsdelivr.net/gh/renyuhui0415/blogimg@main/202312032250683.png"></p></div><div class="post-copyright-info my-8 px-2 sm:px-6 md:px-8"><div class="article-copyright-info-container"><ul><li><strong>Title:</strong> ROS学习笔记（3）：通信机制之话题通信</li><li><strong>Author:</strong> StarHui</li><li><strong>Created at :</strong> 2023-12-03 21:53:00</li><li><strong>Updated at :</strong> 2023-12-03 22:52:45</li><li><strong>Link:</strong> https://renyuhui0415.github.io/post/topic_communication.html</li><li><strong>License: </strong>This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.</li></ul></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/ROS/">#ROS</a>&nbsp;</li><li class="tag-item"><a href="/tags/Study-Notes/">#Study Notes</a>&nbsp;</li></ul><div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8"><div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="next" rel="next" href="/post/ros_study_notes_2-ros_quick_experience.html"><span class="title flex justify-center items-center"><span class="post-nav-title-item">ROS学习笔记（2）：快速体验ROS</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div><div class="comment-container px-2 sm:px-6 md:px-8 pb-8"><div class="comments-container pjax"><div id="comment-anchor"></div><div class="comment-area-title"><i class="fa-solid fa-comments"></i>&nbsp;Comments</div><div id="waline"></div><script type="module" data-swup-reload-script>import{init}from"/js/libs/waline.mjs";function loadWaline(){init({el:"#waline",serverURL:"https://comment.renyuhui.top/",lang:"zh-CN",dark:'body[class~="dark-mode"]',requiredMeta:["nick","mail"]})}"undefined"!=typeof swup?loadWaline():window.addEventListener("DOMContentLoaded",loadWaline)</script></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">On this page</div><div class="page-title">ROS学习笔记（3）：通信机制之话题通信</div><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="nav-text">前置知识</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-text">概述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1"><span class="nav-text">话题通信</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%90%86%E8%AE%BA%E6%A8%A1%E5%9E%8B"><span class="nav-text">理论模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#c%E5%AE%9E%E7%8E%B0%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1"><span class="nav-text">C++实现话题通信</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#talker%E5%AE%9E%E7%8E%B0"><span class="nav-text">talker实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#listener%E5%AE%9E%E7%8E%B0"><span class="nav-text">listener实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python%E5%AE%9E%E7%8E%B0%E8%AF%9D%E9%A2%98%E9%80%9A%E4%BF%A1"><span class="nav-text">Python实现话题通信</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#talker%E5%AE%9E%E7%8E%B0-1"><span class="nav-text">talker实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#listener%E5%AE%9E%E7%8E%B0-1"><span class="nav-text">listener实现</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#c%E4%B8%8Epython%E8%8A%82%E7%82%B9%E9%80%9A%E4%BF%A1"><span class="nav-text">C++与Python节点通信</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89msg"><span class="nav-text">自定义msg</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89msg%E6%96%87%E4%BB%B6"><span class="nav-text">定义msg文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%BE%91%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">编辑配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8Bmsg%E7%9A%84%E4%B8%AD%E9%97%B4%E6%96%87%E4%BB%B6"><span class="nav-text">查看msg的中间文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#c%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89msg"><span class="nav-text">C++使用自定义msg</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#python%E4%BD%BF%E7%94%A8%E8%87%AA%E5%AE%9A%E4%B9%89msg"><span class="nav-text">Python使用自定义msg</span></a></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2023</span> - 2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">StarHui</a></div><script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">VISITOR COUNT</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">TOTAL PAGE VIEWS</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span> <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.6</a></span></div><div>Blog up for <span class="odometer" id="runtime_days"></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li><li class="go-comment"><i class="fa-regular fa-comments"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fa-solid fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa-solid fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/libs/Swup.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/libs/SwupSlideTheme.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/libs/SwupScriptsPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/libs/SwupProgressPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/libs/SwupScrollPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/tools/imageViewer.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/utils.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/main.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/layouts/navbarShrink.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/tools/scrollTopBottom.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/tools/lightDarkSwitch.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/layouts/categoryList.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/tools/localSearch.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/tools/codeBlock.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/layouts/lazyload.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/tools/runtime.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/libs/odometer.min.js"></script><link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/assets/odometer-theme-minimal.css"><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/libs/Typed.min.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/plugins/typed.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/libs/minimasonry.min.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/plugins/masonry.js"></script><div class="post-scripts" data-swup-reload-script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/libs/anime.min.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/tools/tocToggle.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/layouts/toc.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/plugins/tabs.js"></script></div><div id="aplayer"></div><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/libs/APlayer.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.6/source/js/plugins/aplayer.js"></script></body></html>